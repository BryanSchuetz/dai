<!-- Check for a productin environment that will allow the shuffle plugin to run -->
{% if jekyll.environment == 'prod' %}
  <!-- Shuffle corporate related items -->
  {% assign shuffled_related = site.related | shuffle %}
  {% else %}
    {% assign shuffled_related = site.related %}
{% endif %}

<!-- shuffle related projects -->
{% if  jekyll.environment == 'prod' %}
  {% assign shuffled_projects = site.projects | shuffle %}
{% else %}
  {% assign shuffled_projects = site.projects %}
{% endif %}

<!-- shuffle related news stories -->
{% if  jekyll.environment == 'prod' %}
  {% assign shuffled_news = site.news | shuffle %}
{% else %}
  {% assign shuffled_news = site.news %}
{% endif %}

<!-- related box markup -->
<p id="last"></p>
<div id="slidebox">
  <a class="close">x</a>
  <p class="title">RELATED CONTENT:</p>
{% if page.collection == 'projects' %}
  {% assign related_pick = shuffled_projects %}
{% elsif page.collection == 'news'  %}
  {% assign related_pick = shuffled_news %}
{% else %}
  {% assign related_pick = shuffled_related %}
{% endif %}
  <!-- show related item -->
  {% for related in related_pick limit: 1 %}
    <h2><a href="{{ related.permalink | default: related.url }}">{{ related.title | markdownify | remove: '<p>' | remove: '</p>' }}</a></h2>
    {{ related.summary | markdownify }}
  <a href="{{ related.permalink | default: related.url }}" class="primary-block--button">Read More <svg class="redirect" viewBox="0 0 36 70" preserveAspectRatio="xMinYMax meet"><use xlink:href="#redirect"></use></svg></a>
  {% endfor %}
</div>

<!-- related box animation  -->
<script type="text/javascript">
  $(function() {
  	$(window).scroll(function(){

      var distanceTop = $('#last').offset().top - $(window).height() - 225;

  		if  ($(window).scrollTop() > distanceTop)
  			$('#slidebox').animate({'right':'0%', 'easing':'swing'},300);
  		else
  			$('#slidebox').stop(true).animate({'right':'-45%', 'easing':'swing'},300);
  	});

  	$('#slidebox .close').bind('click',function(){
  		$(this).parent().remove();
  	});
  });
</script>
