<!-- Check for a productin environment that will allow the shuffle plugin to run -->
{% if jekyll.environment== 'prod' %}
  <!-- Shuffle the items in site.related -->
  {% assign shuffled_related = site.related | shuffle %}
  {% else %}
    {% assign shuffled_related = site.related %}
{% endif %}

<!-- related box markup -->
<p id="last"></p>
<div id="slidebox">
  <a class="close">x</a>
  <p class="title">RELATED CONTENT:</p>
  <!-- loop though items in the shuffled collectin of related items -->
  {% for related in shuffled_related limit: 1 %}
    <h2><a href="{{ related.link }}">{{ related.title | markdownify | remove: '<p>' | remove: '</p>' }}</a></h2>
    <p>{{ related.description }}</p>
  <a href="{{ related.link }}" class="primary-block--button">Read More <svg class="redirect" viewBox="0 0 36 70" preserveAspectRatio="xMinYMax meet"><use xlink:href="#redirect"></use></svg></a>
  {% endfor %}
</div>

<!-- related box animation  -->
<script type="text/javascript">
  $(function() {
  	$(window).scroll(function(){

      var distanceTop = $('#last').offset().top - $(window).height() - 225;

  		if  ($(window).scrollTop() > distanceTop)
  			$('#slidebox').animate({'right':'0%', 'easing':'swing'},300);
  		else
  			$('#slidebox').stop(true).animate({'right':'-45%', 'easing':'swing'},300);
  	});

  	$('#slidebox .close').bind('click',function(){
  		$(this).parent().remove();
  	});
  });
</script>
